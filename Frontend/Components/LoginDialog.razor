@using Frontend.Models
@using Shared.DTOs

@if (Show)
{
    <div class="modal-backdrop"></div>

    <div class="modal show d-block">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">Login</h5>
                    <button class="btn-close" @onclick="Cancel"></button>
                </div>

                <div class="modal-body">

                    <label>User</label>
                    <select class="form-select" @bind="selectedId">
                        <option value="">-- Select offline user --</option>

                        @foreach (var user in OfflineUsers)
                        {
                            <option value="@user.Id">@user.FullName</option>
                        }
                    </select>

                    <label class="mt-2">Password</label>

                    <div class="input-group">
                        <input class="form-control"
                               type=@(showPassword ? "text" : "password")
                               @bind="password" />

                        <button type="button"
                                class="btn btn-outline-secondary"
                                @onclick="TogglePasswordVisibility"
                                tabindex="-1">
                            <i class="bi @(showPassword ? "bi-eye-slash" : "bi-eye")"></i>
                        </button>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-success" @onclick="Confirm">Submit</button>
                </div>

            </div>
        </div>
    </div>
}

@code {
    [Parameter] public List<User> OfflineUsers { get; set; } = new();
    [Parameter] public EventCallback<(int Id, string password)> OnConfirm { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    [Parameter] public bool Show { get; set; }

    private int? selectedId;
    private string password = string.Empty;
    private bool showPassword;

    private void TogglePasswordVisibility()
        => showPassword = !showPassword;

    private async Task Confirm()
    {
        if (selectedId != null)
            await OnConfirm.InvokeAsync(((int)selectedId, password));
    }

    private async Task Cancel()
        => await OnCancel.InvokeAsync();
}
